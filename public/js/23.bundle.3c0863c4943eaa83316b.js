(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{961:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var a=n(22),r=(Object(a.a)((function(){return Promise.all([n.e(0),n.e(13)]).then(n.bind(null,967))})),Object(a.a)((function(){return Promise.all([n.e(0),n.e(38)]).then(n.bind(null,968))}))),o=Object(a.a)((function(){return Promise.all([n.e(0),n.e(39)]).then(n.bind(null,969))}))},983:function(e,t,n){"use strict";n.r(t);var a=n(47),r=n.n(a),o=n(4),c=n.n(o),l=n(5),i=n.n(l),s=n(9),u=n.n(s),m=n(35),p=n.n(m),d=n(54),f=n.n(d),b=n(31),E=n.n(b),h=n(0),g=n.n(h),v=n(21),x=n(28),y=n(206),w=n.n(y),O=n(207),_=n.n(O),N=n(149),j=n.n(N),k=n(209),D=n.n(k),C=n(106),S=n(942),P=n(203),T=n(941),F=n(58),W=n.n(F),q=n(50),B=n.n(q),I=n(875),R=n.n(I),z=n(895),A=n(896),$=n(897),M=n(898),H=n(899),J=n(900),G=n(961);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(n,!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=Object(x.withStyles)((function(e){var t;return{pageContentWrapper:{width:"100%",marginTop:3*e.spacing.unit,minHeight:"75vh",overflowX:"auto"},table:{margin:"8px 0"},cell:{padding:"8px 4px"},cell_subtotal:{padding:"8px 4px !important",display:"flex",flexDirection:"column",textAlign:"center",fontSize:e.typography.pxToRem(14)},pageContent:{padding:3*e.spacing.unit},panelDetails:{flexDirection:"column",padding:"8px 4px"},panelDetailsRow:(t={flexDirection:"column"},u()(t,e.breakpoints.up("md"),{flexDirection:"row"}),u()(t,"padding","8px 4px"),t),selectNative:{display:"block"},gridButtonsFooter:{margin:"8px",width:"auto",alignItems:"center"},ButtonsOrder:{width:"100%"},panelTotal:{backgroundColor:"rgb(9 202 0 / 12%)",opacity:"unset !important"},root:{width:"100%"},heading:{fontSize:e.typography.pxToRem(18),flexBasis:"90%",flexShrink:0,fontWeight:500,marginLeft:"8px"},headingTotal:{fontSize:e.typography.pxToRem(18),fontWeight:"bold"},secondaryHeading:{fontSize:e.typography.pxToRem(15),color:e.palette.text.secondary}}}))((function(e){var t=e.history,n=Object(h.useState)(!1),a=E()(n,2),o=a[0],l=a[1],s=Object(h.useState)([]),m=E()(s,2),d=(m[0],m[1],Object(h.useState)({})),b=E()(d,2),x=b[0],y=b[1],O=Object(h.useState)("customer"),N=E()(O,2),k=N[0],F=N[1],q=Object(h.useState)(null),I=E()(q,2),L=I[0],X=I[1],K=Object(h.useState)(null),Q=E()(K,2),V=Q[0],Y=Q[1],Z=Object(h.useState)([]),ee=E()(Z,2),te=ee[0],ne=ee[1],ae=Object(h.useState)({total_bruto:0,total:0,delivery_cost:0,discount:0,payment_method:""}),re=E()(ae,2),oe=re[0],ce=re[1],le=function(){var e=f()(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.prev=1,e.next=4,S.d.store({});case 4:t=e.sent,X(t.id),l(!1),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),l(!1);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();Object(h.useEffect)((function(){le()}),[]),Object(h.useEffect)((function(){oe.total>0&&Ee()}),[oe.total]),Object(h.useEffect)((function(){V&&(0==te.length?ie(!1):ie())}),[oe.total_bruto]),Object(h.useEffect)((function(){V&&ie(!1)}),[oe.discount]),Object(h.useEffect)((function(){"ef"==oe.payment_method&&"p"==V.type&&ce((function(e){return U({},e,{discount:10})}))}),[oe.payment_method]);var ie=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=oe.total_bruto,n=oe.delivery_cost;parseFloat(oe.discount)&&(t-=oe.discount*t/100),e&&(n=t<1500&&"p"==V.type?150:0,t+=n),t!=oe.total&&ce((function(e){return U({},e,{total:Number(t.toFixed(2)),delivery_cost:n})}))},se=function(e){return function(t,n){V?F(!!n&&e):y({type:"error",body:"Debe elegir un cliente primero",closed:function(){return y({})}})}},ue=function(e){Y(e),F("items")},me=function(e,t){ce((function(n){return U({},n,u()({},e.name,"number"==t?Number(e.value):e.value))}))},pe=e.classes,de=i()(e,["classes"]),fe=function(){var e=f()(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=te[t].id,e.next=3,S.e.delete(n);case 3:e.sent,ce((function(e){return U({},e,{total_bruto:Number((parseFloat(e.total_bruto)-parseFloat(te[t].price_final)).toFixed(2))})})),y({type:"success",body:'"'+te[t].name+'" eliminado',closed:function(){return y({})}}),ne((function(e){return e.splice(t,1),r()(e)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=f()(p.a.mark((function e(t){var n,a,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=U({},t)).id_order=L,e.next=4,S.e.store(n);case 4:a=e.sent,o=U({},t,{},a),ne((function(e){return e.push(o),r()(e)})),ce((function(e){return U({},e,{total_bruto:Number((parseFloat(e.total_bruto)+parseFloat(a.price_final)).toFixed(2))})})),y({type:"success",body:'"'+t.name+'" agregado',closed:function(){return y({})}});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ee=function(){var e=f()(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=U({},oe)).id_customer=V.id,e.next=4,S.d.update(L,U({},t));case 4:n=e.sent,y({type:"success",body:'Orden "'+n.id+'" creada con éxito',closed:function(){return y({})}});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),he=function(){var e=f()(p.a.mark((function e(){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.prev=1,e.next=4,Ee();case 4:e.sent,l(!1),t.push(C.a("backoffice.general.orders.index")),e.next=17;break;case 9:if(e.prev=9,e.t0=e.catch(1),console.log(e.t0),e.t0.response){e.next=14;break}throw new Error("Unknown error");case 14:n=e.t0.response.data.errors,setErrors(n),l(!1);case 17:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();return g.a.createElement(T.b,c()({},de,{pageTitle:"Nuevo Pedido # ".concat(L),tabs:[],message:x,showBreadcrumbs:!1}),g.a.createElement("div",{className:pe.pageContentWrapper},o&&g.a.createElement(P.b,null),g.a.createElement(v.p,{expanded:"customer"===k,onChange:se("customer")},g.a.createElement(v.r,{expandIcon:g.a.createElement(z.a,null)},g.a.createElement(A.a,null),g.a.createElement(v.mb,{className:pe.heading},V?V.name:"Cliente")),g.a.createElement(v.q,{className:pe.panelDetails},g.a.createElement(G.a,c()({},de,{customer:V,setCustomer:ue})))),g.a.createElement(v.p,{expanded:"items"===k,onChange:se("items")},g.a.createElement(v.r,{expandIcon:g.a.createElement(z.a,null)},g.a.createElement($.a,null),g.a.createElement(v.mb,{className:pe.heading},"Productos ($",oe.total_bruto?oe.total_bruto:"0.00",")")),g.a.createElement(v.q,{className:pe.panelDetails},g.a.createElement(w.a,{className:pe.table},g.a.createElement(_.a,null,te.map((function(e,t){return g.a.createElement(D.a,{key:e.quantity},g.a.createElement(j.a,{scope:"row",className:pe.cell},e.name," ",g.a.createElement("br",null),e.quantity," x ",e.price_unit," ",g.a.createElement("br",null),e.discount," %"),g.a.createElement(j.a,{className:pe.cell_subtotal},g.a.createElement(B.a,{className:pe.button,"aria-label":"Delete",onClick:function(){return fe(t)}},g.a.createElement(R.a,null)),g.a.createElement("b",null,"$ ",e.price_final)))})))),g.a.createElement(G.b,c()({typePrice:V?V.type:"m",total:oe.total,addItemsToOrder:be},de)))),g.a.createElement(v.p,{expanded:"extras"===k,onChange:se("extras")},g.a.createElement(v.r,{expandIcon:g.a.createElement(z.a,null)},g.a.createElement(M.a,null),g.a.createElement(v.mb,{className:pe.heading},"Extras (- $",oe.discount+oe.delivery_cost>0?oe.discount*oe.total_bruto/100+oe.delivery_cost:"0",")")),g.a.createElement(v.q,{className:pe.panelDetailsRow},g.a.createElement(v.v,{item:!0,xs:12,sm:4},g.a.createElement(v.D,{shrink:!0,htmlFor:"payment_method"},"Método de pago"),g.a.createElement(v.N,{onChange:function(e){return me(e.target,"text")},className:pe.selectNative,value:oe.payment_method,input:g.a.createElement(v.A,{name:"payment_method"})},g.a.createElement("option",{value:""},"No definido"),g.a.createElement("option",{value:"ef"},"Efectivo"),g.a.createElement("option",{value:"trans"},"Transferencia"),g.a.createElement("option",{value:"mp"},"Mercado Pago"))),g.a.createElement(v.v,{item:!0,xs:12,sm:4},g.a.createElement(v.D,{htmlFor:"discount"},"Descuento %"," ",g.a.createElement("span",null)),g.a.createElement(v.A,{name:"discount",type:"number",min:1,step:1,max:100,value:oe.discount,onChange:function(e){return me(e.target,"number")},fullWidth:!0})),g.a.createElement(v.v,{item:!0,xs:12,sm:4},g.a.createElement(v.D,{htmlFor:"delivery_cost"},"Costo de envío",g.a.createElement("span",null)),g.a.createElement(v.A,{name:"delivery_cost",type:"number",value:oe.delivery_cost,onChange:function(e){return t=e.target,ce((function(e){return U({},e,u()({},t.name,Number(t.value)))})),void ie(!1);var t},fullWidth:!0})))),g.a.createElement(v.p,{expanded:"comments"===k,onChange:se("comments")},g.a.createElement(v.r,{expandIcon:g.a.createElement(z.a,null)},g.a.createElement(H.a,null),g.a.createElement(v.mb,{className:pe.heading},"Notas del pedido")),g.a.createElement(v.q,{className:pe.panelDetails},g.a.createElement(v.v,{item:!0,xs:12,sm:12},g.a.createElement(v.jb,{name:"notes",onChange:function(e){return me(e.target,"text")},label:"Notas",multiline:!0,fullWidth:!0,variant:"outlined",rowsMax:8})))),g.a.createElement(v.p,{disabled:!0,className:pe.panelTotal},g.a.createElement(v.r,{className:pe.panelTotal},g.a.createElement(J.a,null),g.a.createElement(v.mb,{className:pe.headingTotal},"Total pedido: $",oe.total))),g.a.createElement(v.v,{container:!0,className:pe.gridButtonsFooter,spacing:24},g.a.createElement(v.v,{item:!0,xs:12},g.a.createElement(W.a,{className:pe.ButtonsOrder,variant:"contained",color:"primary",disabled:!(oe.total>0),onClick:function(){return he()}},"Guardar")))))}))}}]);